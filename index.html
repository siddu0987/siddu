<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Decentralized Resume Verification</title>
<script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
<style>
  body {
    font-family: 'Inter', sans-serif;
    background: #eaf1fb;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  .card {
    background: #fff;
    width: 420px;
    padding: 25px 30px;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    text-align: center;
  }

  h2 {
    color: #222;
    margin-bottom: 20px;
  }

  .status {
    background: #007bff;
    color: white;
    padding: 8px;
    border-radius: 6px;
    font-size: 14px;
    display: inline-block;
    margin-bottom: 15px;
  }

  input[type="file"] {
    margin-top: 10px;
  }

  .verify-btn {
    width: 100%;
    background: #28a745;
    color: white;
    padding: 12px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    margin-top: 20px;
  }

  .verify-btn:hover {
    background: #218838;
  }

  .result {
    margin-top: 15px;
    padding: 10px;
    border-radius: 6px;
    font-weight: 500;
  }

  .error {
    color: #dc3545;
  }

  .success {
    color: #28a745;
  }

  #connectBtn {
    background: #007bff;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    margin-bottom: 10px;
  }

  #connectBtn:hover {
    background: #0056b3;
  }
</style>
</head>
<body>

<div class="card">
  <h2>Decentralized Resume Verification</h2>

  <button id="connectBtn">üîó Connect Wallet</button>
  <p class="status" id="walletStatus">Not Connected</p>

  <h4>Upload Resume PDF</h4>
  <input type="file" id="resumeFile" accept="application/pdf" />

  <div class="result" id="verificationStatus"></div>

  <button class="verify-btn" id="verifyBtn">‚úÖ Verify Resume (Admin Only)</button>
</div>

<script>
  const CONTRACT_ADDRESS = "0xd9145CCE52D386f254917e481eB44e9943F39138";
  const CONTRACT_ABI = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "resumeId",
				"type": "uint256"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			}
		],
		"name": "ResumeSubmitted",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "resumeId",
				"type": "uint256"
			}
		],
		"name": "ResumeVerified",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_email",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_qualification",
				"type": "string"
			},
			{
				"internalType": "string[]",
				"name": "_skills",
				"type": "string[]"
			},
			{
				"internalType": "string",
				"name": "_experience",
				"type": "string"
			}
		],
		"name": "submitResume",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"stateMutability": "payable",
		"type": "fallback"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_resumeId",
				"type": "uint256"
			}
		],
		"name": "verifyResume",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"stateMutability": "payable",
		"type": "receive"
	},
	{
		"inputs": [],
		"name": "admin",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getMyResumeIds",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_resumeId",
				"type": "uint256"
			}
		],
		"name": "getResume",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "email",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "qualification",
				"type": "string"
			},
			{
				"internalType": "string[]",
				"name": "skills",
				"type": "string[]"
			},
			{
				"internalType": "string",
				"name": "experience",
				"type": "string"
			},
			{
				"internalType": "bool",
				"name": "verified",
				"type": "bool"
			},
			{
				"internalType": "address",
				"name": "submittedBy",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "resumeCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "resumes",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "email",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "qualification",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "experience",
				"type": "string"
			},
			{
				"internalType": "bool",
				"name": "verified",
				"type": "bool"
			},
			{
				"internalType": "address",
				"name": "submittedBy",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "resumesByUser",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

  let web3;
  let contract;
  let userAccount;

  async function connectWallet() {
    if (window.ethereum) {
      web3 = new Web3(window.ethereum);
      const accounts = await ethereum.request({ method: "eth_requestAccounts" });
      userAccount = accounts[0];
      contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
      document.getElementById("walletStatus").textContent = "‚úÖ Wallet Connected";
      document.getElementById("connectBtn").style.display = "none";
    } else {
      alert("Please install MetaMask!");
    }
  }

  document.getElementById("connectBtn").addEventListener("click", connectWallet);

  document.getElementById("verifyBtn").addEventListener("click", async () => {
    const fileInput = document.getElementById("resumeFile");
    const statusDiv = document.getElementById("verificationStatus");

    if (!fileInput.files.length) {
      statusDiv.innerHTML = "<span class='error'>‚ùå Please upload a resume PDF first.</span>";
      return;
    }

    if (!contract) {
      statusDiv.innerHTML = "<span class='error'>‚ùå Connect wallet first.</span>";
      return;
    }

    try {
      // Simulate reading the file
      const reader = new FileReader();
      reader.onload = async function() {
        statusDiv.innerHTML = "‚è≥ Verifying...";
        // You could hash the file content here before verification
        try {
          // Only admin can call verifyResume in your contract
          await contract.methods.verifyResume(0).send({ from: userAccount });
          statusDiv.innerHTML = "<span class='success'>‚úÖ Resume Verified Successfully!</span>";
        } catch (err) {
          statusDiv.innerHTML = "<span class='error'>‚ùå Error verifying resume: " + err.message + "</span>";
        }
      };
      reader.readAsArrayBuffer(fileInput.files[0]);
    } catch (error) {
      statusDiv.innerHTML = "<span class='error'>‚ùå Error reading or verifying resume.</span>";
    }
  });
</script>
</body>
</html>
